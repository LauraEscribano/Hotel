<!-- views/reservation/confirmation.ejs -->
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Confirmación de la Reserva</title>
  <link rel="stylesheet" href="/css/style.css" media="all">
  <link rel="stylesheet" href="/css/reservation.css" media="all">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>

<body>
  <!-- Header -->

  <%- include('../partials/header') %>

    <!-- ========================== SECCIÓN 1: BARRA DE PROGRESO ========================== -->

    <div class="container mt-5">
      <div class="booking-progress mb-5">
        <div class="row">
          <div class="col-12">
            <div class="progress-steps">
              <div class="progress-bar"></div>
              <div class="step">
                <span class="step-number">1</span>
                <span class="step-title">Selección de Habitación</span>
              </div>
              <div class="step">
                <span class="step-number">2</span>
                <span class="step-title">Datos del Cliente</span>
              </div>
              <div class="step active">
                <span class="step-number">3</span>
                <span class="step-title">Confirmación de Reserva</span>
              </div>
            </div>
          </div>
        </div>
      </div><br>

    <!-- ========================== FIN DE SECCIÓN 1: BARRA DE PROGRESO ========================== -->

    <!-- ========================== SECCIÓN 2: CONFIRMACIÓN DE RESERVA ========================== -->
    <div id="pdf-content">
    <div class="text-center mb-5">
      <h1 class="display-5 fw-bold">
        <i class="fas fa-check-circle me-2"></i>¡Reserva Confirmada!
      </h1>
      <p class="lead text-muted">Tu reserva se ha registrado exitosamente. Guarda tu código de confirmación para futuras referencias.</p>
    </div>
    
    <div class="container">
      <div class="alert alert-success text-center">
        <strong>Código de Reserva:</strong> <%= code %>
      </div>
    </div>

    


 <!-- Main Content Grid -->
 <div class="row">
  <!-- Left: Details -->
  <div class="col-md-6">
    <!-- Resumen de Reserva Card -->
    <div class="booking-summary card mb-4">
      <div class="card-header">
        <h2 class="mb-0"><i class="fas fa-receipt"></i> Resumen de la Reserva</h2>
      </div>
      <div class="card-body">
        <div class="room-details">
          <div class="detail-item"><i class="fas fa-calendar-alt"></i> <span>Check-In: </span> <%= formatDate(summary.checkIn) %></div>
          <div class="detail-item"><i class="fas fa-calendar-alt"></i> <span>Check-Out: </span> <%= formatDate(summary.checkOut) %></div>
          <div class="detail-item"><i class="fas fa-star"></i> <span>Categoría:</span> <%= summary.roomCategory %></div>
          <div class="detail-item"><i class="fas fa-door-open"></i> <span>Habitaciones:</span> <%= summary.rooms %></div>
          <div class="detail-item"><i class="fas fa-moon"></i> <span>Noches:</span> <%= summary.nights %></div>
        </div>
      </div>
    </div>

    <!-- Datos del Cliente Card -->
    <% if (clientData) { %>
    <div class="booking-summary card mb-4">
      <div class="card-header section-header">
        <h2 class="mb-0"><i class="fas fa-user"></i> Datos del Cliente</h2>
      </div>
      <div class="card-body">
        <div class="detail-item d-flex align-items-center mb-3">
          <i class="fas fa-user-circle me-3 icon-lg"></i>
          <div><span class="detail-label">Nombre:</span>
            <span class="detail-value text-muted"><%= clientData.nom %> <%= clientData.cognoms %></span></div>
        </div>
        <div class="detail-item d-flex align-items-center mb-3">
          <i class="fas fa-id-card me-3 icon-lg"></i>
          <div><span class="detail-label">DNI:</span>
            <span class="detail-value text-muted"><%= clientData.dni %></span></div>
        </div>
        <div class="detail-item d-flex align-items-center">
          <i class="fas fa-envelope me-3 icon-lg"></i>
          <div><span class="detail-label">Email:</span>
            <span class="detail-value text-muted"><%= clientData.email %></span></div>
        </div>
      </div>
    </div>
    <% } %>

    <!-- Servicios Contratados Card -->
    <% if (services && services.length) { %>
    <div class="booking-summary card mb-4">
      <div class="card-header section-header">
        <h2 class="mb-0"><i class="fas fa-concierge-bell"></i> Servicios Contratados</h2>
      </div>
      <div class="card-body">
        <ul>
          <% services.forEach(id => { const s = hotelServices.find(h => h.idServei === id); %>
          <li><i class="fas fa-check-circle me-2"></i><%= s.nomServei %> – <%= parseFloat(s.preu).toFixed(2) %>€</li>
          <% }) %>
        </ul>
      </div>
    </div>
    <% } %>
  </div>

  <!-- Right: Invoice Style Price Breakdown -->
  <div class="col-md-6">
    <div class="invoice card mb-4">
      <div class="card-header text-center bg-light">
        <h3 class="mb-0"><i class="fas fa-file-invoice"></i> Detalle de Factura</h3>
      </div>
      <div class="card-body">
        <div class="invoice-item d-flex justify-content-between">
          <span>Precio Habitación (<%= summary.rooms %> x <%= summary.nights %> noches)</span>
          <span><%= summary.roomsPrice %>€</span>
        </div>
        <div class="invoice-item d-flex justify-content-between">
          <span>Servicios</span>
          <span><%= servicesPrice %>€</span>
        </div>
        <hr>
        <div class="invoice-item d-flex justify-content-between fw-bold">
          <span>Total a Pagar</span>
          <span><%= totalPrice %>€</span>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<div class="text-center mt-4 mb-5 no-print">
  <a href="/home" class="btn btn-primary">Volver al Inicio</a>
  <button onclick="window.print()" class="btn btn-secondary ms-2">
    <i class="fas fa-file-pdf me-1"></i> Guardar como PDF
  </button>
  
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
    <%- include('../partials/footer') %>
</body>

</html>